<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-S63: Logistic Regression - Concepts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #FAF9F6; color: #374151; scroll-behavior: smooth; }
        .nav-button { transition: all 0.3s ease; border-bottom: 3px solid transparent; }
        .nav-button.active { border-color: #4338CA; color: #4338CA; font-weight: 600; }
        .nav-button:not(.active):hover { border-color: #6366F1; color: #6366F1; }
        .content-section { min-height: calc(100vh - 180px); }
        .section-intro { font-size: 1.125rem; color: #4B5563; margin-bottom: 1.5rem; text-align: center; max-width: 800px; margin-left: auto; margin-right: auto; }
        .header-icon { font-size: 1.5rem; margin-right: 0.5rem; color: #4338CA; }
        .interactive-panel {
            background-color: #eef2ff;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
        }
        .interactive-panel .panel-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #4338CA;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        input[type="number"], textarea {
            padding: 0.6rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #c7d2fe;
            background-color: white;
            font-size: 1rem;
            color: #374151;
            width: 100%;
            max-width: 250px; /* Constrain width for inputs */
            margin-bottom: 0.5rem;
        }
        textarea {
            max-width: 100%;
            min-height: 80px;
            resize: vertical;
        }
        .action-button {
            background-color: #4338CA;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            margin-top: 1rem;
            display: inline-block;
            margin-right: 0.5rem;
            margin-left: 0.5rem;
        }
        .action-button:hover {
            background-color: #6366F1;
            transform: translateY(-1px);
        }
        .results-box {
            background-color: #ffffff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-top: 1.5rem;
        }
        .results-box h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 1rem;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed #e5e7eb;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-label {
            font-weight: 500;
            color: #4B5563;
        }
        .result-value {
            font-weight: 600;
            color: #1F2937;
        }
        .feedback-box {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: #D1FAE5;
            color: #065F46;
            border: 1px solid #34D399;
        }
        .code-block {
            background-color: #2D3748; /* Dark background for code */
            color: #E2E8F0; /* Light text */
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Fira Code', 'Cascadia Code', monospace; /* Monospace font */
            overflow-x: auto; /* Allow horizontal scrolling for long lines */
            margin-top: 1rem;
            margin-bottom: 1rem;
            position: relative;
        }
        .code-block pre {
            margin: 0;
        }
        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #4A5568;
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 0.3rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-button:hover {
            background-color: #6366F1;
        }
        .chart-container {
            position: relative;
            height: 400px; /* Increased height for better visibility */
            width: 100%;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }
        /* Message Box Styling */
        #messageBox {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        .input-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4B5563;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-indigo-700">N-S63: Logistic Regression - Concepts</h1>
            <nav class="mt-4">
                <ul class="flex flex-wrap justify-center gap-3 sm:gap-6">
                    <li><a href="#theory-lr" class="nav-button active text-sm sm:text-base font-medium py-2 px-3">ðŸ“š Theory</a></li>
                    <li><a href="#practical-demo" class="nav-button text-sm sm:text-base font-medium py-2 px-3">ðŸ’» Churn Demo</a></li>
                    <li><a href="#credit-card-demo" class="nav-button text-sm sm:text-base font-medium py-2 px-3">ðŸ’³ Credit Card Demo</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow">
        
        <section id="theory-lr" class="content-section mb-12">
            <h2 class="text-2xl font-semibold text-indigo-600 mb-6 text-center"><span class="header-icon">ðŸ“š</span>Theory: Introduction to Logistic Regression</h2>
            <p class="section-intro">While Linear Regression is excellent for predicting continuous outcomes, many business problems involve predicting a **binary outcome** (e.g., Yes/No, Churn/No Churn, Buy/No Buy). For such scenarios, **Logistic Regression** is the go-to statistical model.</p>
            
            <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
                <h3 class="text-xl font-semibold text-indigo-500 mb-3">1. Why Not Linear Regression for Binary Outcomes?</h3>
                <p class="mb-4 text-gray-700 leading-relaxed">If we tried to use Linear Regression for a binary dependent variable (e.g., coded as 0 or 1), we would face several issues:</p>
                <ul class="list-disc pl-5 space-y-2 text-gray-700">
                    <li>**Non-normal Residuals:** The errors would not be normally distributed, violating a key assumption.</li>
                    <li>**Heteroscedasticity:** The variance of the errors would not be constant.</li>
                    <li>**Predicted Values Outside [0, 1]:** Linear regression could predict probabilities less than 0 or greater than 1, which are nonsensical for probabilities.</li>
                    <li>**Non-linear Relationship:** The relationship between a predictor and a binary outcome is often S-shaped, not linear.</li>
                </ul>
                <p class="mt-4 text-gray-700 leading-relaxed font-bold">Logistic Regression addresses these issues by modeling the probability of the outcome falling into a particular category.</p>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
                <h3 class="text-xl font-semibold text-indigo-500 mb-3">2. The Logistic Function (Sigmoid Function)</h3>
                <p class="mb-4 text-gray-700 leading-relaxed">The core of Logistic Regression is the **Logistic (or Sigmoid) Function**. This function takes any real-valued number and maps it into a value between 0 and 1, making it perfect for modeling probabilities.</p>
                
                <h4 class="text-lg font-semibold text-gray-800 mb-2">Formula:</h4>
                <div class="code-block bg-gray-100 text-gray-800 p-4 rounded-md">
                    <pre><code>$$ P(Y=1) = \frac{1}{1 + e^{-z}} $$</code></pre>
                    <p class="text-sm text-gray-600 mt-2">Where:</p>
                    <ul class="list-disc pl-5 text-sm text-gray-600">
                        <li>$P(Y=1)$: The probability that the dependent variable $Y$ is equal to 1 (the event of interest, e.g., churn).</li>
                        <li>$e$: The base of the natural logarithm (approximately 2.71828).</li>
                        <li>$z$: A linear combination of the independent variables and their coefficients, similar to the linear part of a linear regression: $$ z = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_k X_k $$</li>
                    </ul>
                </div>
                <p class="mt-4 text-gray-700 leading-relaxed">The Sigmoid function transforms the linear output ($z$) into an S-shaped curve, ensuring that the predicted probabilities always fall between 0 and 1.</p>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
                <h3 class="text-xl font-semibold text-indigo-500 mb-3">3. Logistic Regression Model Equation</h3>
                <p class="mb-4 text-gray-700 leading-relaxed">Combining the linear predictor ($z$) with the Sigmoid function, the Logistic Regression model can be written as:</p>
                <div class="code-block bg-gray-100 text-gray-800 p-4 rounded-md">
                    <pre><code>$$ P(Y=1) = \frac{1}{1 + e^{-(\beta_0 + \beta_1 X_1 + \dots + \beta_k X_k)}} $$</code></pre>
                    <p class="text-sm text-gray-600 mt-2">This equation directly models the probability of the event occurring.</p>
                    <p class="mt-2 text-gray-700 leading-relaxed">Alternatively, Logistic Regression models the **log-odds** (also called the **logit**), which *is* a linear function of the independent variables:</p>
                    <pre><code>$$ \ln\left(\frac{P(Y=1)}{1 - P(Y=1)}\right) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_k X_k $$</code></pre>
                    <p class="text-sm text-gray-600 mt-2">The term $\frac{P(Y=1)}{1 - P(Y=1)}$ is the **odds** of the event occurring. Taking the natural logarithm of the odds gives us the log-odds (logit).</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
                <h3 class="text-xl font-semibold text-indigo-500 mb-3">4. Interpretation of Coefficients</h3>
                <p class="mb-4 text-gray-700 leading-relaxed">Interpreting coefficients ($\beta_j$) in Logistic Regression is different from Linear Regression because they are on the log-odds scale, not the probability scale.</p>
                
                <ul class="list-disc pl-5 space-y-4 text-gray-700">
                    <li><strong>Intercept ($\beta_0$):</strong>
                        <p class="mb-2">The log-odds of $Y=1$ when all independent variables are zero. If $e^{\beta_0}$ is calculated, it represents the odds of $Y=1$ when all $X_j=0$.</p>
                    </li>
                    <li><strong>Partial Slope ($\beta_j$ for $X_j$):</strong>
                        <p class="mb-2">For a one-unit increase in $X_j$, the log-odds of $Y=1$ are expected to change by $\beta_j$, **holding all other independent variables constant.**</p>
                        <p class="mt-2 text-gray-700 leading-relaxed font-bold">To make this more interpretable, we often exponentiate the coefficient ($e^{\beta_j}$), which gives us the **Odds Ratio (OR)**.</p>
                        <ul class="list-disc pl-5 text-sm text-gray-600">
                            <li>If $e^{\beta_j} > 1$: A one-unit increase in $X_j$ is associated with a $e^{\beta_j}$ times increase in the odds of $Y=1$. (e.g., OR of 1.5 means 50% increase in odds).</li>
                            <li>If $e^{\beta_j} < 1$: A one-unit increase in $X_j$ is associated with a $e^{\beta_j}$ times decrease in the odds of $Y=1$. (e.g., OR of 0.8 means 20% decrease in odds).</li>
                            <li>If $e^{\beta_j} = 1$: No change in odds (i.e., no relationship).</li>
                        </ul>
                    </li>
                </ul>
                <p class="mt-4 text-gray-700 leading-relaxed">**Example:** If the coefficient for 'Marketing Spend' is $0.5$, then $e^{0.5} \approx 1.65$. This means for every $1 increase in Marketing Spend, the odds of a customer churning are multiplied by $1.65$ (or increase by $65\%$), holding other factors constant.</p>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h3 class="text-xl font-semibold text-indigo-500 mb-3">5. Assumptions of Logistic Regression</h3>
                <p class="mb-4 text-gray-700 leading-relaxed">While Logistic Regression doesn't have the same strict assumptions as OLS Linear Regression (e.g., normality of residuals), it does have its own set of considerations:</p>
                
                <ul class="list-disc pl-5 space-y-4 text-gray-700">
                    <li><strong>1. Binary Outcome:</strong> The dependent variable must be binary (dichotomous).</li>
                    <li><strong>2. Independence of Observations:</strong> Observations should be independent of each other.</li>
                    <li><strong>3. No Multicollinearity:</strong> Independent variables should not be highly correlated with each other (similar to MLR).</li>
                    <li><strong>4. Linearity of Log-Odds:</strong> There should be a linear relationship between the independent variables and the *log-odds* of the dependent variable. This is the most crucial assumption. It does *not* assume a linear relationship between $X$ and the probability $P(Y=1)$.</li>
                    <li><strong>5. Large Sample Size:</strong> Logistic Regression generally requires a larger sample size than linear regression, especially if you have many predictors or rare events.</li>
                    <li><strong>6. No Extreme Outliers:</strong> While less sensitive than linear regression, extreme outliers can still influence the model.</li>
                </ul>
                <p class="mt-4 text-gray-700 leading-relaxed font-bold">Understanding these assumptions helps ensure the validity and reliability of your Logistic Regression model.</p>
            </div>
        </section>

        <section id="practical-demo" class="content-section mb-12">
            <h2 class="text-2xl font-semibold text-indigo-600 mb-6 text-center"><span class="header-icon">ðŸ’»</span>Practical Demo: Logistic Regression for Churn Prediction</h2>
            <p class="section-intro">Let's apply Logistic Regression to a common business problem: predicting customer churn. We'll use a single predictor: **Customer Usage (hours/week)** to predict **Churn (Yes/No)**.</p>
            
            <div class="interactive-panel">
                <div class="panel-title">Churn Prediction Demo</div>
                <p class="mb-4 text-gray-700">Explore how customer usage might influence churn probability. We'll generate synthetic data, simulate a Logistic Regression model, and then visualize the sigmoid curve.</p>
                
                <div class="input-group">
                    <label for="churn_noise_level">Noise Level (0-10):</label>
                    <input type="number" id="churn_noise_level" value="3" min="0" max="10" step="0.5">
                    <p class="text-sm text-gray-600">Higher values increase randomness in generated data.</p>
                </div>

                <div class="text-center mb-4">
                    <button id="generateChurnDataBtn" class="action-button bg-indigo-600 hover:bg-indigo-700">Generate Data & Show Visuals</button>
                    <button id="showLrPythonCodeBtn" class="action-button bg-green-600 hover:bg-green-700">Show Python Code</button>
                </div>

                <div id="lrPythonCodeSection" class="hidden mt-4">
                    <h4 class="text-indigo-600">Python Code for Logistic Regression (using `statsmodels`):</h4>
                    <div class="code-block">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code id="lrPythonCode">
import numpy as np
import pandas as pd
import statsmodels.api as sm
import matplotlib.pyplot as plt
import seaborn as sns

# For reproducibility, you can set a seed, but for dynamic data, remove or change this.
# np.random.seed(42) 

num_customers = 200
noise_level = 3 # This would come from user input in a real app (e.g., 0-10)
noise_factor = noise_level * 0.5 # Scale noise level to impact log-odds

# Independent Variable: Customer Usage (hours per week)
customer_usage = np.random.normal(loc=15, scale=5, size=num_customers)
customer_usage = np.clip(customer_usage, 1, 30) # Usage between 1 and 30 hours/week

# Dependent Variable: Churn (0 = No Churn, 1 = Churn)
# Let's define a true underlying relationship:
# Lower usage -> higher churn probability
# Using a log-odds relationship: log_odds = intercept + beta * usage
# Let's say: log_odds = 2.0 - 0.2 * usage

true_intercept = 2.0
true_beta_usage = -0.2

# Calculate true log-odds for each customer
true_log_odds = true_intercept + true_beta_usage * customer_usage

# Add noise to the log-odds before converting to probability
# This simulates real-world data where factors other than X also influence Y
noisy_log_odds = true_log_odds + (np.random.rand(num_customers) * 2 - 1) * noise_factor

# Convert noisy log-odds to probabilities using the sigmoid function
noisy_probabilities = 1 / (1 + np.exp(-noisy_log_odds))

# Generate binary churn outcomes based on noisy probabilities
churn = (np.random.rand(num_customers) < noisy_probabilities).astype(int)

data_df = pd.DataFrame({
    'Customer_Usage': customer_usage,
    'Churn': churn
})

print("Generated Data Head:")
print(data_df.head())
print("\nChurn Distribution:")
print(data_df['Churn'].value_counts())

# --- Define X (Independent) and Y (Dependent) Variables ---
X = data_df['Customer_Usage']
Y = data_df['Churn']

# --- Add a constant to the independent variable (for intercept) ---
X = sm.add_constant(X)

# --- Fit the Logistic Regression Model ---
# Use family=sm.families.Binomial() for binary logistic regression
model = sm.GLM(Y, X, family=sm.families.Binomial())
results = model.fit()

# --- Print the Regression Summary ---
print("\n--- Logistic Regression Analysis Summary (statsmodels) ---")
print(results.summary())

# --- Visualize Data and Sigmoid Curve ---
plt.figure(figsize=(10, 7))
sns.scatterplot(x='Customer_Usage', y='Churn', data=data_df, hue='Churn', palette='viridis', s=80, alpha=0.7, legend='full')

# Plot the predicted probabilities (sigmoid curve) based on the *model's* coefficients
# Create a range of usage values for plotting the curve
usage_range = np.linspace(data_df['Customer_Usage'].min(), data_df['Customer_Usage'].max(), 100)
X_plot = sm.add_constant(usage_range)
predicted_probabilities = results.predict(X_plot) # Uses fitted model coefficients

plt.plot(usage_range, predicted_probabilities, color='red', linewidth=2, label='Predicted Churn Probability (Sigmoid Curve)')

plt.title('Customer Churn Probability vs. Usage')
plt.xlabel('Customer Usage (hours/week)')
plt.ylabel('Churn Probability (0 or 1)')
plt.yticks([0, 0.25, 0.5, 0.75, 1])
plt.grid(True, linestyle='--', alpha=0.6)
plt.legend()
plt.show()
</code></pre>
                    </div>
                </div>

                <div id="lrOutputSection" class="hidden mt-4">
                    <h4 class="text-indigo-600">Simulated Logistic Regression Output (from `statsmodels`):</h4>
                    <div class="code-block bg-gray-900 text-gray-100 p-4 rounded-md text-sm">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code id="simulatedLrOutput">
                            Generalized Linear Model Regression Results                             
========================================================================================
Dep. Variable:                  Churn   No. Observations:                  200
Model:                            GLM   Df Residuals:                      198
Family:                      Binomial   Df Model:                            1
Link Function:                  Logit   Scale:                             1.0000
Method:                          IRLS   Pseudo R-squ.:                   0.450
Date:                Thu, 30 May 2025   Log-Likelihood:                -80.000
Time:                        10:00:00   AIC:                             164.0
No. Iterations:                     6   BIC:                             170.6
Covariance Type:            nonrobust                                         
====================================================================================
                       coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------------
const                2.1000      0.400      5.250      0.000       1.314       2.886
Customer_Usage      -0.2100      0.030     -7.000      0.000      -0.269      -0.151
====================================================================================
</code></pre>
                    </div>
                    <h4 class="text-indigo-600 mt-6">Interpretation of Coefficients (Odds Ratios):</h4>
                    <div class="code-block bg-gray-900 text-gray-100 p-4 rounded-md text-sm">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code id="oddsRatioOutput">
Odds Ratios:
const           = exp(2.1000) = 8.16
Customer_Usage  = exp(-0.2100) = 0.81
</code></pre>
                    </div>

                    <h5 class="font-semibold text-lg text-indigo-600 mt-6 mb-2 text-center">Customer Churn Data & Sigmoid Curve</h5>
                    <div class="chart-container">
                        <canvas id="churnScatterSigmoidChart"></canvas>
                    </div>
                    <p class="text-sm text-gray-600 text-center mt-2 mb-4">Figure 1: Scatter plot of Customer Usage vs. Churn (0 or 1), overlaid with the Logistic Regression sigmoid curve representing the predicted churn probability.</p>
                </div>

                <div class="interactive-panel mt-8">
                    <div class="panel-title">Predict Churn Probability</div>
                    <p class="mb-4 text-gray-700">Enter a customer's weekly usage to predict their churn probability using the simulated model. Remember: lower usage tends to increase churn probability.</p>
                    
                    <div class="input-group">
                        <label for="predict_usage">Customer Usage (hours/week):</label>
                        <input type="number" id="predict_usage" value="15" min="1" max="30" step="1">
                    </div>
                    <div class="text-center">
                        <button id="predictChurnBtn" class="action-button">Predict Probability</button>
                    </div>
                    <div id="predictionResult" class="results-box hidden mt-4">
                        <h4>Prediction Result:</h4>
                        <div class="result-item">
                            <span class="result-label">Predicted Churn Probability:</span>
                            <span class="result-value" id="predictedChurnProbability"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Interpretation:</span>
                            <span class="result-value" id="churnInterpretation"></span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">This prediction uses the simulated model: $\ln\left(\frac{P(\text{Churn})}{1 - P(\text{Churn})}\right) = 2.10 - 0.21 \times \text{Customer\_Usage}$</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="credit-card-demo" class="content-section mb-12">
            <h2 class="text-2xl font-semibold text-indigo-600 mb-6 text-center"><span class="header-icon">ðŸ’³</span>Another Practical Example: Credit Card Default Prediction</h2>
            <p class="section-intro">In finance, predicting credit card default is crucial for risk management. We'll build a Logistic Regression model to predict **Default (Yes/No)** based on **Credit_Score** and **Income**.</p>
            
            <div class="interactive-panel">
                <div class="panel-title">Credit Card Default Prediction Demo</div>
                <p class="mb-4 text-gray-700">Here, we'll see how a higher credit score and income generally reduce the probability of default. We'll generate synthetic data, simulate a multiple Logistic Regression model, and visualize the relationships.</p>
                
                <div class="input-group">
                    <label for="default_noise_level">Noise Level (0-10):</label>
                    <input type="number" id="default_noise_level" value="3" min="0" max="10" step="0.5">
                    <p class="text-sm text-gray-600">Higher values increase randomness in generated data.</p>
                </div>

                <div class="text-center mb-4">
                    <button id="generateDefaultDataBtn" class="action-button bg-indigo-600 hover:bg-indigo-700">Generate Data & Show Visuals</button>
                    <button id="showDefaultPythonCodeBtn" class="action-button bg-green-600 hover:bg-green-700">Show Python Code</button>
                </div>

                <div id="defaultPythonCodeSection" class="hidden mt-4">
                    <h4 class="text-indigo-600">Python Code for Multiple Logistic Regression (using `statsmodels`):</h4>
                    <div class="code-block">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code id="defaultPythonCode">
import numpy as np
import pandas as pd
import statsmodels.api as sm
import matplotlib.pyplot as plt
import seaborn as sns

# For reproducibility, you can set a seed, but for dynamic data, remove or change this.
# np.random.seed(100) 

num_customers = 300
noise_level_default = 3 # This would come from user input in a real app (e.g., 0-10)
noise_factor_default = noise_level_default * 0.5 # Scale noise level to impact log-odds

# Independent Variables: Credit Score and Income
credit_score = np.random.normal(loc=650, scale=80, size=num_customers)
credit_score = np.clip(credit_score, 300, 850) # FICO score range

income = np.random.normal(loc=50, scale=15, size=num_customers) # in thousands of dollars
income = np.clip(income, 20, 150)

# Dependent Variable: Default (0 = No Default, 1 = Default)
# Let's define a true underlying relationship:
# Higher credit score and higher income -> lower default probability
# log_odds = intercept - beta_score * Credit_Score - beta_income * Income

true_intercept_default = 10.0
true_beta_credit_score = -0.015
true_beta_income = -0.05

# Calculate true log-odds for each customer
true_log_odds_default = true_intercept_default + \
                        true_beta_credit_score * credit_score + \
                        true_beta_income * income

# Add noise to the log-odds before converting to probability
noisy_log_odds_default = true_log_odds_default + (np.random.rand(num_customers) * 2 - 1) * noise_factor_default

# Convert noisy log-odds to probabilities using the sigmoid function
noisy_probabilities_default = 1 / (1 + np.exp(-noisy_log_odds_default))

# Generate binary default outcomes based on noisy probabilities
default = (np.random.rand(num_customers) < noisy_probabilities_default).astype(int)

data_default_df = pd.DataFrame({
    'Credit_Score': credit_score,
    'Income': income,
    'Default': default
})

print("Generated Default Data Head:")
print(data_default_df.head())
print("\nDefault Distribution:")
print(data_default_df['Default'].value_counts())

# --- Define X (Independent) and Y (Dependent) Variables ---
Y_default = data_default_df['Default']
X_default = data_default_df[['Credit_Score', 'Income']]

# --- Add a constant to the independent variable (for intercept) ---
X_default = sm.add_constant(X_default)

# --- Fit the Logistic Regression Model ---
model_default = sm.GLM(Y_default, X_default, family=sm.families.Binomial())
results_default = model_default.fit()

# --- Print the Regression Summary ---
print("\n--- Credit Card Default Logistic Regression Summary (statsmodels) ---")
print(results_default.summary())

# --- Visualize Data and Sigmoid Curves (Partial Effects) ---
# Plot Default vs. Credit Score, holding Income at its median
median_income = data_default_df['Income'].median()
credit_score_range = np.linspace(data_default_df['Credit_Score'].min(), data_default_df['Credit_Score'].max(), 100)
income_fixed_for_plot = np.full(100, median_income)

X_plot_credit_score = pd.DataFrame({
    'const': 1,
    'Credit_Score': credit_score_range,
    'Income': income_fixed_for_plot
})
predicted_prob_credit_score = results_default.predict(X_plot_credit_score)

plt.figure(figsize=(12, 6))

plt.subplot(1, 2, 1)
sns.scatterplot(x='Credit_Score', y='Default', data=data_default_df, hue='Default', palette='coolwarm', s=80, alpha=0.7, legend='full')
plt.plot(credit_score_range, predicted_prob_credit_score, color='green', linewidth=2, label=f'Predicted Default Prob (Income={median_income:.0f}k)')
plt.title('Default Probability vs. Credit Score')
plt.xlabel('Credit Score')
plt.ylabel('Default (0 or 1)')
plt.yticks([0, 0.25, 0.5, 0.75, 1])
plt.grid(True, linestyle='--', alpha=0.6)
plt.legend()

# Plot Default vs. Income, holding Credit Score at its median
median_credit_score = data_default_df['Credit_Score'].median()
income_range = np.linspace(data_default_df['Income'].min(), data_default_df['Income'].max(), 100)
credit_score_fixed_for_plot = np.full(100, median_credit_score)

X_plot_income = pd.DataFrame({
    'const': 1,
    'Credit_Score': credit_score_fixed_for_plot,
    'Income': income_range
})
predicted_prob_income = results_default.predict(X_plot_income)

plt.subplot(1, 2, 2)
sns.scatterplot(x='Income', y='Default', data=data_default_df, hue='Default', palette='coolwarm', s=80, alpha=0.7, legend='full')
plt.plot(income_range, predicted_prob_income, color='purple', linewidth=2, label=f'Predicted Default Prob (Score={median_credit_score:.0f})')
plt.title('Default Probability vs. Income')
plt.xlabel('Income (thousands $)')
plt.ylabel('Default (0 or 1)')
plt.yticks([0, 0.25, 0.5, 0.75, 1])
plt.grid(True, linestyle='--', alpha=0.6)
plt.legend()

plt.tight_layout()
plt.show()
</code></pre>
                    </div>
                </div>

                <div id="defaultOutputSection" class="hidden mt-4">
                    <h4 class="text-indigo-600">Simulated Logistic Regression Output (from `statsmodels`):</h4>
                    <div class="code-block bg-gray-900 text-gray-100 p-4 rounded-md text-sm">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code id="simulatedDefaultLrOutput">
                            Generalized Linear Model Regression Results                             
========================================================================================
Dep. Variable:                 Default   No. Observations:                  300
Model:                            GLM   Df Residuals:                      297
Family:                      Binomial   Df Model:                            2
Link Function:                  Logit   Scale:                             1.0000
Method:                          IRLS   Pseudo R-squ.:                   0.680
Date:                Thu, 30 May 2025   Log-Likelihood:                -95.000
Time:                        10:00:00   AIC:                             196.0
No. Iterations:                     7   BIC:                             207.1
Covariance Type:            nonrobust                                         
================================================================================
                   coef    std err          z      P>|z|      [0.025      0.975]
--------------------------------------------------------------------------------
const           10.5000      1.500      7.000      0.000       7.560      13.440
Credit_Score    -0.0160      0.002     -8.000      0.000      -0.020      -0.012
Income          -0.0520      0.008     -6.500      0.000      -0.068      -0.036
================================================================================
</code></pre>
                    </div>
                    <h4 class="text-indigo-600 mt-6">Interpretation of Coefficients (Odds Ratios):</h4>
                    <div class="code-block bg-gray-900 text-gray-100 p-4 rounded-md text-sm">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code id="defaultOddsRatioOutput">
Odds Ratios:
const           = exp(10.5000) = 36695.00
Credit_Score    = exp(-0.0160) = 0.9841
Income          = exp(-0.0520) = 0.9493
</code></pre>
                    </div>

                    <h5 class="font-semibold text-lg text-indigo-600 mt-6 mb-2 text-center">Credit Card Default Data & Sigmoid Curves</h5>
                    <div class="chart-container">
                        <canvas id="defaultScatterSigmoidChart"></canvas>
                    </div>
                    <p class="text-sm text-gray-600 text-center mt-2 mb-4">Figure 2: Scatter plots of Default vs. Credit Score (left) and Default vs. Income (right), each overlaid with the Logistic Regression sigmoid curve. The curves show the predicted default probability when the other variable is held at its median.</p>
                </div>

                <div class="interactive-panel mt-8">
                    <div class="panel-title">Predict Default Probability</div>
                    <p class="mb-4 text-gray-700">Enter a customer's credit score and income to predict their default probability using the simulated model. Remember: higher scores/income generally reduce default risk.</p>
                    
                    <div class="flex flex-col sm:flex-row gap-4 mb-2">
                        <div class="flex-1 input-group">
                            <label for="predict_credit_score">Credit Score (300-850):</label>
                            <input type="number" id="predict_credit_score" value="650" min="300" max="850" step="1">
                        </div>
                        <div class="flex-1 input-group">
                            <label for="predict_income">Income (thousands $):</label>
                            <input type="number" id="predict_income" value="50" min="20" max="150" step="1">
                        </div>
                    </div>
                    <div class="text-center">
                        <button id="predictDefaultBtn" class="action-button">Predict Probability</button>
                    </div>
                    <div id="predictionDefaultResult" class="results-box hidden mt-4">
                        <h4>Prediction Result:</h4>
                        <div class="result-item">
                            <span class="result-label">Predicted Default Probability:</span>
                            <span class="result-value" id="predictedDefaultProbability"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Interpretation:</span>
                            <span class="result-value" id="defaultInterpretation"></span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">This prediction uses the simulated model: $\ln\left(\frac{P(\text{Default})}{1 - P(\text{Default})}\right) = 10.50 - 0.016 \times \text{Credit\_Score} - 0.052 \times \text{Income}$</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white text-center p-4 text-sm">
        <p>&copy; FACE Prep Campus, 2025</p>
    </footer>

    <div id="messageBox" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg z-50" role="alert">
        <strong class="font-bold">Error!</strong>
        <span id="messageText" class="block sm:inline"></span>
        <span class="absolute top-0 bottom-0 right-0 px-4 py-3 cursor-pointer" onclick="document.getElementById('messageBox').classList.add('hidden');">
            <svg class="fill-current h-6 w-6 text-red-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>Close</title><path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/></svg>
        </span>
    </div>

    <script>
        // Global variables for synthetic data and chart instances
        let customerUsageData = [];
        let churnData = [];
        let creditScoreData = [];
        let incomeData = [];
        let defaultData = [];
        
        let churnScatterSigmoidChartInstance = null;
        let defaultScatterSigmoidChartInstance = null;

        // Simulated coefficients for churn prediction
        const simulated_b0_churn = 2.1000;
        const simulated_b_usage_churn = -0.2100;

        // Simulated coefficients for default prediction
        const simulated_b0_default = 10.5000;
        const simulated_b_credit_score = -0.0160;
        const simulated_b_income = -0.0520;

        // --- Message Box Function ---
        function showMessage(message, type = 'error') {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            messageText.innerText = message;
            messageBox.classList.remove('hidden');
            if (type === 'error') {
                messageBox.classList.remove('bg-green-100', 'border-green-400', 'text-green-700');
                messageBox.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            } else {
                messageBox.classList.remove('bg-red-100', 'border-red-400', 'text-red-700'); // Remove red if previously error
                messageBox.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
            }
        }

        // --- Code Copy Function ---
        function copyCode(button) {
            const codeBlock = button.nextElementSibling;
            const textToCopy = codeBlock.textContent;
            
            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                button.textContent = 'Copied!';
            } catch (err) {
                console.error('Failed to copy text: ', err);
                button.textContent = 'Error!';
            }
            document.body.removeChild(textarea);

            setTimeout(() => {
                button.textContent = 'Copy';
            }, 2000);
        }

        // --- MathJax Rendering Function ---
        function renderMathInElement(elementId) {
            const element = document.getElementById(elementId);
            if (element && typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                // Ensure MathJax is ready and then typeset
                MathJax.startup.promise.then(() => {
                    MathJax.typesetPromise([element]).catch(err => console.error("MathJax rendering error for element:", elementId, err));
                });
            } else if (!element) {
                console.warn(`Element with ID '${elementId}' not found for MathJax rendering.`);
            } else {
                console.warn("MathJax not fully loaded or configured. Skipping MathJax rendering for:", elementId);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Navigation button active state logic
            document.querySelectorAll('nav a').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            // --- Churn Demo Logic ---
            const generateChurnDataBtn = document.getElementById('generateChurnDataBtn');
            const showLrPythonCodeBtn = document.getElementById('showLrPythonCodeBtn');
            const lrPythonCodeSection = document.getElementById('lrPythonCodeSection');
            const lrOutputSection = document.getElementById('lrOutputSection');
            const churnNoiseLevelInput = document.getElementById('churn_noise_level');

            const predictUsageInput = document.getElementById('predict_usage');
            const predictChurnBtn = document.getElementById('predictChurnBtn');
            const predictionResultDiv = document.getElementById('predictionResult');
            const predictedChurnProbabilitySpan = document.getElementById('predictedChurnProbability');
            const churnInterpretationSpan = document.getElementById('churnInterpretation');

            showLrPythonCodeBtn.addEventListener('click', function() {
                lrPythonCodeSection.classList.toggle('hidden');
            });

            generateChurnDataBtn.addEventListener('click', function() {
                lrOutputSection.classList.remove('hidden');
                const noiseLevel = parseFloat(churnNoiseLevelInput.value);
                generateSyntheticChurnData(noiseLevel);
                drawChurnScatterSigmoidChart();
                renderMathInElement('lrOutputSection'); // Render MathJax in simulated output
            });

            predictChurnBtn.addEventListener('click', function() {
                const usage = parseFloat(predictUsageInput.value);
                if (isNaN(usage)) {
                    showMessage("Please enter a valid number for Customer Usage.", "error");
                    return;
                }
                predictChurnProbability(usage);
                predictionResultDiv.classList.remove('hidden');
                renderMathInElement('predictionResult'); // Render MathJax in prediction result
            });

            // --- Credit Card Default Demo Logic ---
            const generateDefaultDataBtn = document.getElementById('generateDefaultDataBtn');
            const showDefaultPythonCodeBtn = document.getElementById('showDefaultPythonCodeBtn');
            const defaultPythonCodeSection = document.getElementById('defaultPythonCodeSection');
            const defaultOutputSection = document.getElementById('defaultOutputSection');
            const defaultNoiseLevelInput = document.getElementById('default_noise_level');

            const predictCreditScoreInput = document.getElementById('predict_credit_score');
            const predictIncomeInput = document.getElementById('predict_income');
            const predictDefaultBtn = document.getElementById('predictDefaultBtn');
            const predictionDefaultResultDiv = document.getElementById('predictionDefaultResult');
            const predictedDefaultProbabilitySpan = document.getElementById('predictedDefaultProbability');
            const defaultInterpretationSpan = document.getElementById('defaultInterpretation');

            showDefaultPythonCodeBtn.addEventListener('click', function() {
                defaultPythonCodeSection.classList.toggle('hidden');
            });

            generateDefaultDataBtn.addEventListener('click', function() {
                defaultOutputSection.classList.remove('hidden');
                const noiseLevel = parseFloat(defaultNoiseLevelInput.value);
                generateSyntheticDefaultData(noiseLevel);
                drawDefaultScatterSigmoidChart();
                renderMathInElement('defaultOutputSection'); // Render MathJax in simulated output
            });

            predictDefaultBtn.addEventListener('click', function() {
                const creditScore = parseFloat(predictCreditScoreInput.value);
                const income = parseFloat(predictIncomeInput.value);
                if (isNaN(creditScore) || isNaN(income)) {
                    showMessage("Please enter valid numbers for Credit Score and Income.", "error");
                    return;
                }
                predictDefaultProbability(creditScore, income);
                predictionDefaultResultDiv.classList.remove('hidden');
                renderMathInElement('predictionDefaultResult'); // Render MathJax in prediction result
            });


            // --- Data Generation Function (Client-side for Charts) ---
            function generateSyntheticChurnData(noiseLevel) {
                const numCustomers = 200;
                Math.seedrandom(new Date().getTime().toString()); // Dynamic seed for new data each time
                const noiseFactor = noiseLevel * 0.5; // Scale noise level to impact log-odds

                customerUsageData = [];
                churnData = [];

                const true_intercept = 2.10; // Adjusted slightly for better visual spread
                const true_beta_usage = -0.21; // Adjusted slightly for better visual spread

                for (let i = 0; i < numCustomers; i++) {
                    const usage = Math.random() * (30 - 1) + 1; // Usage between 1 and 30 hours/week
                    
                    const true_log_odds = true_intercept + true_beta_usage * usage;
                    
                    // Add noise to the log-odds before converting to probability
                    const noisy_log_odds = true_log_odds + (Math.random() * 2 - 1) * noiseFactor;
                    const noisy_probability = 1 / (1 + Math.exp(-noisy_log_odds));

                    // Generate binary churn outcome based on noisy probabilities
                    const churn = Math.random() < noisy_probability ? 1 : 0;

                    customerUsageData.push(usage);
                    churnData.push(churn);
                }
                console.log("Synthetic churn data generated with noise level:", noiseLevel);
            }

            function generateSyntheticDefaultData(noiseLevel) {
                const numCustomers = 300;
                Math.seedrandom(new Date().getTime().toString()); // Dynamic seed for new data each time
                const noiseFactor = noiseLevel * 0.5; // Scale noise level to impact log-odds

                creditScoreData = [];
                incomeData = [];
                defaultData = [];

                const true_intercept_default = 10.50;
                const true_beta_credit_score = -0.016;
                const true_beta_income = -0.052;

                for (let i = 0; i < numCustomers; i++) {
                    const credit_score = Math.random() * (850 - 300) + 300;
                    const income = Math.random() * (150 - 20) + 20;

                    const true_log_odds = true_intercept_default +
                                     true_beta_credit_score * credit_score +
                                     true_beta_income * income;
                    
                    // Add noise to the log-odds before converting to probability
                    const noisy_log_odds = true_log_odds + (Math.random() * 2 - 1) * noiseFactor;
                    const noisy_probability = 1 / (1 + Math.exp(-noisy_log_odds));

                    // Generate binary default outcomes based on noisy probabilities
                    const default_status = Math.random() < noisy_probability ? 1 : 0;

                    creditScoreData.push(credit_score);
                    incomeData.push(income);
                    defaultData.push(default_status);
                }
                console.log("Synthetic default data generated with noise level:", noiseLevel);
            }


            // --- Predict Churn Probability Function ---
            function predictChurnProbability(usage) {
                const log_odds = simulated_b0_churn + simulated_b_usage_churn * usage;
                const probability = 1 / (1 + Math.exp(-log_odds));
                
                predictedChurnProbabilitySpan.textContent = `${(probability * 100).toFixed(2)}%`;

                let interpretation = "";
                if (probability >= 0.7) {
                    interpretation = "High probability of churn. This customer is at significant risk.";
                } else if (probability >= 0.5) {
                    interpretation = "Moderate probability of churn. Keep an eye on this customer.";
                } else if (probability >= 0.3) {
                    interpretation = "Low probability of churn. This customer is relatively stable.";
                } else {
                    interpretation = "Very low probability of churn. This customer is likely to stay.";
                }
                churnInterpretationSpan.textContent = interpretation;
            }

            // --- Predict Default Probability Function ---
            function predictDefaultProbability(creditScore, income) {
                const log_odds = simulated_b0_default +
                                 simulated_b_credit_score * creditScore +
                                 simulated_b_income * income;
                const probability = 1 / (1 + Math.exp(-log_odds));
                
                predictedDefaultProbabilitySpan.textContent = `${(probability * 100).toFixed(2)}%`;

                let interpretation = "";
                if (probability >= 0.7) {
                    interpretation = "Very high risk of default. Consider immediate action.";
                } else if (probability >= 0.5) {
                    interpretation = "High risk of default. This customer needs close monitoring.";
                } else if (probability >= 0.3) {
                    interpretation = "Moderate risk of default. Proceed with caution.";
                } else if (probability >= 0.1) {
                    interpretation = "Low risk of default. This customer is likely reliable.";
                } else {
                    interpretation = "Very low risk of default. Excellent candidate.";
                }
                defaultInterpretationSpan.textContent = interpretation;
            }


            // --- Chart Drawing Functions ---
            function drawChurnScatterSigmoidChart() {
                const ctx = document.getElementById('churnScatterSigmoidChart').getContext('2d');
                if (!ctx) { console.error("Churn Scatter Sigmoid Chart context not found."); return; }
                console.log("Drawing Churn Scatter Sigmoid Chart...");

                if (churnScatterSigmoidChartInstance) {
                    churnScatterSigmoidChartInstance.destroy();
                }

                const churnPoints = customerUsageData.map((usage, i) => ({ x: usage, y: churnData[i] }));

                // Generate points for the sigmoid curve
                const usageRange = Array.from({ length: 100 }, (_, i) => 1 + i * (29 / 99)); // 1 to 30
                const sigmoidCurvePoints = usageRange.map(usage => {
                    const log_odds = simulated_b0_churn + simulated_b_usage_churn * usage;
                    const probability = 1 / (1 + Math.exp(-log_odds));
                    return { x: usage, y: probability };
                });

                churnScatterSigmoidChartInstance = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: [
                            {
                                label: 'Customer Churn (0=No, 1=Yes)',
                                data: churnPoints,
                                backgroundColor: churnPoints.map(point => point.y === 1 ? '#EF4444' : '#4338CA'), // Red for churn, Indigo for no churn
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                pointStyle: 'circle',
                                borderColor: 'rgba(0,0,0,0.2)',
                                borderWidth: 1
                            },
                            {
                                label: 'Predicted Churn Probability (Sigmoid Curve)',
                                data: sigmoidCurvePoints,
                                type: 'line',
                                borderColor: '#10B981', // Green
                                borderWidth: 3,
                                fill: false,
                                pointRadius: 0,
                                showLine: true,
                                tension: 0.2 // Smooth the curve
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Customer Churn Probability vs. Usage',
                                font: { size: 16, weight: 'bold' },
                                color: '#374151'
                            },
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        if (context.dataset.label === 'Customer Churn (0=No, 1=Yes)') {
                                            return `Usage: ${context.parsed.x.toFixed(1)}, Churn: ${context.parsed.y === 1 ? 'Yes' : 'No'}`;
                                        } else if (context.dataset.label === 'Predicted Churn Probability (Sigmoid Curve)') {
                                            return `Usage: ${context.parsed.x.toFixed(1)}, Prob: ${(context.parsed.y * 100).toFixed(1)}%`;
                                        }
                                        return null;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom',
                                title: {
                                    display: true,
                                    text: 'Customer Usage (hours/week)',
                                    color: '#4B5563'
                                },
                                min: 0,
                                max: 31 // Extend slightly beyond 30 for visual padding
                            },
                            y: {
                                type: 'linear',
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Churn Probability',
                                    color: '#4B5563'
                                },
                                min: -0.1, // Allow points at 0 and 1 to be visible
                                max: 1.1,
                                ticks: {
                                    stepSize: 0.25,
                                    callback: function(value) {
                                        return (value * 100).toFixed(0) + '%'; // Format as percentage
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }

            function drawDefaultScatterSigmoidChart() {
                const ctx = document.getElementById('defaultScatterSigmoidChart').getContext('2d');
                if (!ctx) { console.error("Default Scatter Sigmoid Chart context not found."); return; }
                console.log("Drawing Default Scatter Sigmoid Chart...");

                if (defaultScatterSigmoidChartInstance) {
                    defaultScatterSigmoidChartInstance.destroy();
                }

                const defaultPoints = defaultData.map((d, i) => ({ x: creditScoreData[i], y: d, income: incomeData[i] }));

                // Calculate median income and credit score for plotting partial effects
                const medianIncome = incomeData.slice().sort((a, b) => a - b)[Math.floor(incomeData.length / 2)];
                const medianCreditScore = creditScoreData.slice().sort((a, b) => a - b)[Math.floor(creditScoreData.length / 2)];

                // Generate points for sigmoid curve (Default vs. Credit Score, holding Income at median)
                const creditScoreRange = Array.from({ length: 100 }, (_, i) => 300 + i * (550 / 99)); // 300 to 850
                const sigmoidCreditScorePoints = creditScoreRange.map(score => {
                    const log_odds = simulated_b0_default + simulated_b_credit_score * score + simulated_b_income * medianIncome;
                    const probability = 1 / (1 + Math.exp(-log_odds));
                    return { x: score, y: probability };
                });

                // Generate points for sigmoid curve (Default vs. Income, holding Credit Score at median)
                const incomeRange = Array.from({ length: 100 }, (_, i) => 20 + i * (130 / 99)); // 20 to 150
                const sigmoidIncomePoints = incomeRange.map(income => {
                    const log_odds = simulated_b0_default + simulated_b_credit_score * medianCreditScore + simulated_b_income * income;
                    const probability = 1 / (1 + Math.exp(-log_odds));
                    return { x: income, y: probability };
                });

                defaultScatterSigmoidChartInstance = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: [
                            {
                                label: 'Default (0=No, 1=Yes) vs. Credit Score',
                                data: defaultPoints.map(p => ({ x: p.x, y: p.y })), // Use credit score for x-axis
                                backgroundColor: defaultPoints.map(point => point.y === 1 ? '#EF4444' : '#4338CA'), // Red for default, Indigo for no default
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                pointStyle: 'circle',
                                borderColor: 'rgba(0,0,0,0.2)',
                                borderWidth: 1,
                                xAxisID: 'creditScoreAxis', // Assign to specific X axis
                                yAxisID: 'defaultYAxis'
                            },
                            {
                                label: 'Default (0=No, 1=Yes) vs. Income',
                                data: defaultPoints.map(p => ({ x: p.income, y: p.y })), // Use income for x-axis
                                backgroundColor: defaultPoints.map(point => point.y === 1 ? '#EF4444' : '#4338CA'), // Red for default, Indigo for no default
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                pointStyle: 'triangle', // Different shape for income points
                                borderColor: 'rgba(0,0,0,0.2)',
                                borderWidth: 1,
                                xAxisID: 'incomeAxis', // Assign to specific X axis
                                yAxisID: 'defaultYAxis'
                            },
                            {
                                label: `Predicted Default Prob (Income=${medianIncome.toFixed(0)}k)`,
                                data: sigmoidCreditScorePoints,
                                type: 'line',
                                borderColor: '#10B981', // Green for Credit Score curve
                                borderWidth: 3,
                                fill: false,
                                pointRadius: 0,
                                showLine: true,
                                tension: 0.2,
                                xAxisID: 'creditScoreAxis',
                                yAxisID: 'defaultYAxis'
                            },
                            {
                                label: `Predicted Default Prob (Score=${medianCreditScore.toFixed(0)})`,
                                data: sigmoidIncomePoints,
                                type: 'line',
                                borderColor: '#9333EA', // Purple for Income curve
                                borderWidth: 3,
                                fill: false,
                                pointRadius: 0,
                                showLine: true,
                                tension: 0.2,
                                xAxisID: 'incomeAxis',
                                yAxisID: 'defaultYAxis'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Credit Card Default Probability vs. Credit Score & Income',
                                font: { size: 16, weight: 'bold' },
                                color: '#374151'
                            },
                            legend: {
                                display: true,
                                position: 'bottom',
                                labels: {
                                    filter: function(item, chart) {
                                        // Only show labels for the curves and one of the scatter plots
                                        return item.text.includes('Predicted') || item.text.includes('Credit Score');
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        if (context.dataset.label.includes('Default (0=No, 1=Yes)')) {
                                            const originalPoint = defaultPoints[context.dataIndex];
                                            return `Score: ${originalPoint.x.toFixed(0)}, Income: ${originalPoint.income.toFixed(0)}k, Default: ${originalPoint.y === 1 ? 'Yes' : 'No'}`;
                                        } else if (context.dataset.label.includes('Predicted')) {
                                            return `${context.dataset.label.split('(')[0].trim()}: X=${context.parsed.x.toFixed(0)}, Prob: ${(context.parsed.y * 100).toFixed(1)}%`;
                                        }
                                        return null;
                                    }
                                }
                            }
                        },
                        scales: {
                            creditScoreAxis: {
                                type: 'linear',
                                position: 'bottom',
                                title: {
                                    display: true,
                                    text: 'Credit Score',
                                    color: '#4B5563'
                                },
                                min: 250,
                                max: 900,
                                grid: {
                                    drawOnChartArea: false // Only draw grid for one axis
                                }
                            },
                            incomeAxis: {
                                type: 'linear',
                                position: 'bottom',
                                title: {
                                    display: true,
                                    text: 'Income (thousands $)',
                                    color: '#4B5563'
                                },
                                min: 10,
                                max: 160,
                                grid: {
                                    drawOnChartArea: false // Only draw grid for one axis
                                }
                            },
                            defaultYAxis: {
                                type: 'linear',
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Default Probability',
                                    color: '#4B5563'
                                },
                                min: -0.1,
                                max: 1.1,
                                ticks: {
                                    stepSize: 0.25,
                                    callback: function(value) {
                                        return (value * 100).toFixed(0) + '%';
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }


            // Initial render of MathJax for the theory section on load
            renderMathInElement('theory-lr');
        });

        // Load MathJax for rendering LaTeX
        const mathJaxScript = document.createElement('script');
        mathJaxScript.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js";
        mathJaxScript.async = true;
        document.body.appendChild(mathJaxScript);

        // Simple Math.seedrandom for client-side data generation consistency
        (function(global) {
            let seed = 0;
            global.Math.seedrandom = function(s) {
                // Use string hash for seed
                let hash = 0;
                for (let i = 0; i < s.length; i++) {
                    const char = s.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash |= 0; // Convert to 32bit integer
                }
                seed = Math.abs(hash) % 2147483647; // Ensure positive and within range
            };
            global.Math.random = function() {
                seed = (seed * 9301 + 49297) % 233280;
                return seed / 233280;
            };
        })(this);
    </script>
</body>
</html>
